!function(t){function e(n){if(a[n])return a[n].exports;var r=a[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}var r=a(1),i=(n(r),a(4)),o=(n(i),a(5));n(o);a(6)},function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),l=a(2),c=n(l),u=function(t){function e(){return r(this,e),i(this,Object.getPrototypeOf(e).apply(this,arguments))}return o(e,t),s(e,[{key:"afterAxes",value:function(){var t=this;t.fnArea=d3.svg.area().x(function(e,a){return t.x_scale(e.x)}).y(function(e){return e(t.range_attr)}).y0(function(e){return t.y_scale(e.y0)}).y1(function(e){return t.y_scale(e.y0+e.y)}).interpolate(t.interpolation),t.fnStack=d3.layout.stack().values(function(t){return t.values}),t.fnColor=d3.scale.category20()}},{key:"serializeData",value:function(t){console.log("unserialized data",t);var e=this,a={series:[]};return t.series.forEach(function(t,n){console.log(t),"x"!==e.domain_attr&&"y"!==e.range_attr&&(console.log("bla"),t.values=t.map(function(a){return{x:a[e.domain_attr],y:a[e.range_attr],series:t}})),a.series.push(t)}),a.series=e.fnStack(a.series),a.domain_extent=d3.extent(a.series[0].values.map(function(t){return t.x})),a.range_max=d3.max(a.series[a.series.length-1].values.map(function(t){return t.y0+t.y})),console.log("serialized data",a),a}},{key:"drawData",value:function(t){var e=this;t=e.serializeData(t),e.y_scale.domain([0,t.range_max]),e.svg.select(".d3-chart-range.d3-chart-axis").call(e.y_axis),e.x_scale.domain(t.domain_extent),e.svg.select(".d3-chart-domain.d3-chart-axis").call(e.x_axis);var a=e.svg.selectAll(".d3-chart-spline-stack").data(t.series);[a.enter().append("path"),a.transition()].forEach(function(t){e.applyData(t)}),a.exit().remove()}},{key:"applyData",value:function(t){var e=this;t.attr("class",function(t){"d3-chart-spline-stack "+t.css_class}).attr("d",function(t){return e.fnArea(t.values)}).style("fill",function(t){return e.fnColor(t.title)})}},{key:"chart_options",get:function(){return Object.assign(Object.assign({},c["default"].DEFAULTS),{interpolation:"cardinal",range_attr:"y",domain_attr:"x",time_series:!0})}}]),e}(c["default"]);e["default"]=u},function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),l=a(3),c=n(l),u=function(t){function e(){return r(this,e),i(this,Object.getPrototypeOf(e).apply(this,arguments))}return o(e,t),s(e,[{key:"defineAxes",value:function(){var t=this;t.y_scale=d3.scale.linear().range([t.height,0]),t.y_axis=d3.svg.axis().scale(t.y_scale).orient("left").outerTickSize(1),t.time_series?t.x_scale=d3.time.scale().range([0,t.width]):t.x_scale=d3.scale.linear().range([0,t.width]),t.x_axis=d3.svg.axis().scale(t.x_scale).orient("bottom").outerTickSize(0),t.svg.append("g").attr("class","d3-chart-range d3-chart-axis"),t.svg.append("g").attr("class","d3-chart-domain d3-chart-axis").attr("transform","translate(0, "+t.height+")")}},{key:"afterAxes",value:function(){var t=this;t.line=d3.svg.line().interpolate(t.chart_options.interpolation).x(function(e){return t.x_scale(e[t.domain_attr])}).y(function(e){return t.y_scale(e[t.range_attr])}),t.color=d3.scale.category20()}},{key:"serializeData",value:function(t){var e=this,a={series:[],range_min:1/0,range_max:-(1/0),domain_min:1/0,domain_max:-(1/0)};return t.forEach(function(t){var n=Object.assign({css_class:e.toClass?e.toClass(t):"",title:e.titleize?e.titleize(t):"",color:""},t);n.values.forEach(function(t){series_data.range_min=Math.min(series_data.range_min,t[e.range_attr]),series_data.range_max=Math.max(series_data.range_max,t[e.range_attr]),series_data.domain_min=Math.min(series_data.domain_min,t[e.domain_attr]),series_data.domain_max=Math.max(series_data.domain_max,t[e.domain_attr])}),a.series.push(n)}),a}},{key:"drawData",value:function(t){var e=this;t=e.serialize_data,bar_chart.y_scale.domain([Math.min(0,t.range_min),t.range_max]),bar_chart.svg.select(".d3-chart-range.d3-chart-axis").call(bar_chart.y_axis),bar_chart.x_scale.domain([t.domain_max,Math.min(t.domain_min)]),bar_chart.svg.select(".d3-chart-domain.d3-chart-axis").call(bar_chart.x_axis);var a=g.selectAll(".d3-chart-series").data(t.series);[a.enter().append("g"),a.transition()].forEach(function(t){e.applyData(t)}),a.exit().remove()}},{key:"applyData",value:function(t){var e=this;t.attr("class",function(t){return"d3-chart-line "+t.css_class}).attr("title",function(t){return t.title}).append("path").attr("d",function(t){return e.line(t.values)}).style("stroke",function(t){return e.color(t.title)})}},{key:"chart_options",get:function(){return{interpolation:"basis"}}}]),e}(c["default"]);e["default"]=u},function(t,e){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n={outer_width:500,outer_height:300,margin:{top:0,left:70,bottom:50,right:20},domain_ticks:10,range_ticks:8,container:"container",time_series:!1,range_label:void 0,domain_attr:void 0,range_attr:void 0,titleize:function(t,e){var a=e?e.name:t.title;if(!a)return"";for(var n=a.split(" "),r=[],i=0;i<n.length;++i)r.push(n[i].charAt(0).toUpperCase()+n[i].toLowerCase().slice(1));return r.join(" ")},toClass:function(t){return t.css_class?t.css_class.toLowerCase().replace(/\s+/g,"-"):""}},r=function i(t){a(this,i);var e=this;Object.assign(e,e.chart_options,t),e.height=e.outer_height-e.margin.top-e.margin.bottom,e.width=e.outer_width-e.margin.left-e.margin.right,e.svg=d3.select(e.container).append("svg").attr("width",e.outer_width).attr("height",e.outer_height).append("g").attr("transform","translate("+e.margin.left+","+e.margin.top+")"),e.defineAxes(),e.afterAxes&&e.afterAxes()};r.DEFAULTS=n,e["default"]=r},function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),l=a(3),c=n(l),u=function(t){function e(){return r(this,e),i(this,Object.getPrototypeOf(e).apply(this,arguments))}return o(e,t),s(e,[{key:"defineAxes",value:function(){var t=this;t.y_axis=d3.svg.axis().orient("left").outerTickSize(0),t.y_scale=d3.scale.ordinal(),t.svg.append("g").attr("class","d3-chart-range d3-chart-axis"),t.x_scale=d3.scale.ordinal().domain(d3.range(31).map(function(t){return t+1})).rangeRoundBands([0,t.width],t.grid_padding,0),t.x_axis=d3.svg.axis().scale(t.x_scale).orient("top").outerTickSize(0),t.svg.append("g").attr("class","d3-chart-domain d3-chart-axis")}},{key:"afterAxes",value:function(){var t=this;t.grid_unit_size=t.width/31-t.grid_padding*t.width/30,t.display_date_format&&(t.displayDate=d3.time.format(t.display_date_format)),!t.toDate&&t.parse_date_format?(t.parseDate=d3.time.format(t.parse_date_format),t.toDate=function(e){t.parseDate(e[t.date_attr])}):t.toDate||(t.toDate=function(e){return e[t.date_attr]}),t.monthFormat=d3.time.format(t.display_date_format),t.toMonthString=function(e){return t.monthFormat(t.toDate(e))}}},{key:"serializeData",value:function(t){var e=this;if(t.css_class=t.css_class||e.toClass?e.toClass(t):"",e.rangeValue=e.range_attr?function(t){return t[e.range_attr]}:e.rangeValue,t.months=[],void 0!==t.min_range&&void 0!==t.max_range)t.range={min:t.min_range,max:t.max_range},t.values.forEach(function(a){var n=e.toDate(a),r=e.monthFormat(n);t.months.indexOf(r)<0&&t.months.push(r)});else{var a=1/0,n=-(1/0);t.values.forEach(function(r){var i=e.toDate(r),o=e.monthFormat(i),s=e.rangeValue(r);a=Math.min(a,s),n=Math.max(n,s),t.months.indexOf(o)<0&&t.months.push(o)}),e.min_range_zero&&(a=Math.min(a,0)),t.range={min:a,max:n}}return t.range.diff=t.range.max-t.range.min,t.months=t.months.sort(function(t,a){var n=e.monthFormat.parse(t),r=e.monthFormat.parse(a);return n.getTime()-r.getTime()}),t}},{key:"drawLegend",value:function(t){var e=this,a=[e.color,"#fff"];e.gridSize=Math.floor(e.outer_width/31),e.legendElementWidth=3.5*e.gridSize,e.colorScale=d3.scale.quantile().domain([t.range.min,t.range.max]).range(a);var n=e.svg.append("g").attr("class","color-legend"),r=e.svg.selectAll(".legend").data([0].concat(e.colorScale.quantiles()),function(t){return t});r.enter().append("g").attr("class","legend");var i=n.append("defs").append("linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","0%").attr("spreadMethod","pad");i.append("stop").attr("offset","0%").attr("stop-color",a[1]).attr("stop-opacity",1),i.append("stop").attr("offset","100%").attr("stop-color",a[0]).attr("stop-opacity",1),n.append("rect").attr("x",0).attr("y",e.outer_height-75).attr("width",120).attr("height",30).style("fill","url(#gradient)"),r.append("text").attr("class","legend-description").text(function(t){return Math.round(t)}).attr("x",function(t,a){return e.legendElementWidth*a}).attr("y",e.outer_height-30),r.exit().remove()}},{key:"drawData",value:function(t){var e=this;t=e.serializeData(t),e.legend&&e.drawLegend(t);var a=e.grid_unit_size*(1+e.grid_padding)*t.months.length;e.y_scale.rangeRoundBands([0,a],e.grid_padding,0),e.y_scale.domain(t.months),e.y_axis.scale(e.y_scale),e.svg.select(".d3-chart-range").call(e.y_axis),e.svg.select(".d3-chart-domain").call(e.x_axis);var n=e.svg.selectAll(".d3-chart-grid-unit").data(t.values);e.applyData(t,n.enter().append("rect")),e.applyData(t,n.transition()),n.exit().remove()}},{key:"applyData",value:function(t,e){var a=this,n="d3-chart-grid-unit "+t.css_class;e.attr("class",function(t){return n}).attr("y",function(t){var e=a.y_scale(a.toMonthString(t)),n=a.y_scale.rangeBand()/2-a.grid_unit_size/2;return e+n}).attr("height",a.grid_unit_size).attr("x",function(t){return a.x_scale(a.toDate(t).getDate())}).attr("width",function(t){return a.grid_unit_size}).attr("fill",a.color).attr("opacity",function(e){return a.applyOpacity(a.rangeValue(e),t.range)})}},{key:"applyOpacity",value:function(t,e){return Math.max(0,Math.min(1,1-(e.max-(t-e.min))/e.diff))}},{key:"chart_options",get:function(){return Object.assign(Object.assign({},c["default"].DEFAULTS),{outer_width:800,outer_height:360,margin:{top:30,left:150,bottom:30,right:0},grid_padding:.05,display_date_format:"%B %Y",date_attr:"date",range_attr:"value",min_range_zero:!1,color:"#000",legend:!0})}}]),e}(c["default"]);e["default"]=u},function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),l=a(3),c=n(l),u=function(t){function e(){return r(this,e),i(this,Object.getPrototypeOf(e).apply(this,arguments))}return o(e,t),s(e,[{key:"defineAxes",value:function(){var t=this;t.y_scale_left=d3.scale.linear().rangeRound([t.height,0]),t.y_axis_left=d3.svg.axis().scale(t.y_scale_left).orient("left").outerTickSize(1).tickPadding(5),t.y_scale_right=d3.scale.linear().range([t.height,0]),t.y_axis_right=d3.svg.axis().scale(t.y_scale_right).orient("right").outerTickSize(1),t.x_scale=d3.scale.ordinal().rangeRoundBands([0,t.width],.2),t.x_axis=d3.svg.axis().scale(t.x_scale).orient("bottom").outerTickSize(1).ticks(d3.time.day,1).tickFormat(d3.time.format("%a %d")).tickSize(1).tickPadding(15),t.svg.append("g").attr("class","d3-chart-range d3-chart-range-left d3-chart-axis"),t.svg.append("g").attr("class","d3-chart-range d3-chart-range-right d3-chart-axis").attr("transform","translate("+t.width+" ,0)"),t.svg.append("g").attr("class","d3-chart-domain d3-chart-axis").attr("transform","translate(0, "+t.height+")")}},{key:"afterAxes",value:function(){var t=this;t.fnLine=d3.svg.line().interpolate(t.chart_options.interpolation).x(function(e){return t.x_scale(e.date)+t.x_scale.rangeBand()/2}).y(function(e){return t.y_scale_right(e.value)}),t.fnColor=d3.scale.category20(),t.fnStack=d3.layout.stack().values(function(t){return t.values})}},{key:"nestedExtent",value:function(t,e,a){var n={min_domain:1/0,max_domain:-(1/0),min_range:1/0,max_range:-(1/0)};return t.forEach(function(t){t[e].forEach(function(t){n.min_domain=Math.min(n.min_domain,t.value),n.max_domain=Math.max(n.max_domain,t.value),n.min_range=Math.min(n.min_range,t.value),n.max_range=Math.max(n.max_range,t.value)})}),n}},{key:"serializeData",value:function(t){var e=this,a={line_series:[],bar_series:[],raw_bar_values:[]};return a.domain_extent=t.series.map(function(t){return t.date}),t.series.forEach(function(t,n){t.values=t.values.map(function(n){e.line_attrs.forEach(function(e){var r=a.line_series.findIndex(function(t){return t.name===e});0>r?a.line_series.push({name:e,values:[{date:t.date,value:n[e]}]}):a.line_series[r].values.push({date:t.date,value:n[e]})}),e.bar_attrs.forEach(function(e){var r=a.bar_series.findIndex(function(t){return t.name===e});0>r?a.bar_series.push({name:e,values:[{x:t.date,y:n[e]}]}):a.bar_series[r].values.push({x:t.date,y:n[e]})})})}),t.bar_series=e.fnStack(a.bar_series),a.bar_series.forEach(function(t){(!a.bar_length||a.bar_length<t.values.length)&&(a.bar_length=t.values.length),t.values.forEach(function(t){a.raw_bar_values.push(t.y0+t.y)})}),a}},{key:"drawLineData",value:function(t){var e=this,a=e.nestedExtent(t.line_series,"values",e.domain_attr);e.y_scale_right.domain([a.min_domain,a.max_domain]),e.svg.select(".d3-chart-range-right").call(e.y_axis_right);var n=e.svg.selectAll(".d3-chart-line").data(t.line_series);e.applyLineData(n.enter().append("g").attr("class","line"),n.transition()),n.exit().remove()}},{key:"applyLineData",value:function(t){var e=this;t.attr("title",function(t){return t.name}).attr("class","line"),e.svg.selectAll(".line").append("path").style("stroke",function(t){return e.fnColor(t.name)}).attr("d",function(t){return e.fnLine(t.values)})}},{key:"drawBarData",value:function(t){var e=this;e.y_scale_left.domain([0,d3.max(t.raw_bar_values)]),e.svg.select(".d3-chart-range-left").call(e.y_axis_left);var a=e.svg.selectAll(".d3-chart-bar").data(t.bar_series).enter().append("g").attr("class","bar-layer").style("fill",function(t,a){return e.fnColor(a)}).style("fill-opacity","0.7");t.bar_series.forEach(function(n){e.applyBarData(a.selectAll("rect").data(function(t){return t.values}).enter().append("rect"),t.bar_length)})}},{key:"applyBarData",value:function(t,e){var a=this;t.attr("width",a.x_scale.rangeBand()).attr("height",function(t){return a.y_scale_left(t.y0)-a.y_scale_left(t.y+t.y0)}).attr("x",function(t){return a.x_scale(t.x)}).attr("y",function(t){return a.y_scale_left(t.y+t.y0)})}},{key:"drawData",value:function(t){var e=this;t=e.serializeData(t),e.x_scale.domain(t.domain_extent),e.svg.select(".d3-chart-domain.d3-chart-axis").call(e.x_axis),e.drawBarData(t),e.drawLineData(t)}},{key:"chart_options",get:function(){return Object.assign(Object.assign({},c["default"].DEFAULTS),{interpolation:"linear",date_domain:!0,domain_attr:"date"})}}]),e}(c["default"]);e["default"]=u},function(t,e){}]);
//# sourceMappingURL=bundle.min.js.map